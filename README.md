# Data_process

为完成数据预处理，我们编写了如下接口（需在文件中自行配置数据集路径）。

## 训练集

* **select.py**：从原数据集**MS-Celeb-1M-v1c（位于msra文件夹下）**中随机抽取一定比例的人脸照片作为小数据集，以降低数据存储和训练的难度。该文件还包括对数据集中ID数、人脸数和数据集总大小的统计功能，方便实验者了解数据集情况。
* check_face_num.py：使用人脸检测模型，对数据集中每张照片检查其中人脸数量，以确定是否有不含人脸或包含多于1张人脸的照片。
* **remove_no_or_extra_face.py**：使用人脸检测模型，对数据集中每张照片检查其中人脸数量，移除不含人脸或包含多于1张人脸的照片，以完成对数据集的清洗。
* **add_mask_for_trainset.py**：对清洗后的数据集添加口罩。此接口对数据集中所有人脸照片依次添加口罩，产生新的戴口罩人脸的照片，同时保留原照片，使数据集规模扩大到原来的2倍。将每个ID戴口罩和不戴口罩的人脸分别整理到masked和unmasked文件夹下。
* mask_check.py：在add_mask_for_trainset.py为数据集添加口罩后，检查原数据集中是否有照片因算法内部错误而没有产生对应的添加口罩的人脸，可选择删除之（极个别情况）。
* **remove_bad_mask.py**：对添加口罩后的数据集，再次使用人脸检测模型，检查所有masked照片中人脸数量，移除不含人脸或包含多于1张人脸的照片（masked与其对应unmasked成对移除），完成对数据集的二次清洗。
* **crop_face_to_112.py**：对添加口罩后的数据集，使用人脸检测模型检测所有照片（原尺寸为400x400）中人脸边框，并以此目标框为基准，划定一个112x112的正方形作为人脸区域，用该区域来代替原照片，完成对数据集的裁剪。
* resize_400_to_112.py：在crop_face_to_112.py裁剪后，若有极个别照片因未检测到人脸而无法裁剪，将其强制缩小为112x112，保证数据集格式一致。

## 测试集

* make_testset.py：对**LFW, CALFW, CPLFW**三个测试集，假定在数据集目录下已按照如下目录结构存放人脸照片：

    ```
    ├─false  # 该目录下共包含3000对照片，每对照片中的人脸不属于同一人
    │      0au.jpeg  # 第1对照片中的第1张（未戴口罩）
    │      0bu.jpeg  # 第1对照片中的第2张（未戴口罩）
    │      1au.jpeg  # 第2对照片中的第1张（未戴口罩）
    │      1bu.jpeg  # 第2对照片中的第1张（未戴口罩）
           ...
    │      2999au.jpeg
    │      2999bu.jpeg
    │      
    └─true # 该目录下共包含3000对照片，每对照片中的人脸属于同一人
           0au.jpeg  # 第1对照片中的第1张（未戴口罩）
           0bu.jpeg  # 第1对照片中的第2张（未戴口罩）
           1au.jpeg  # 第2对照片中的第1张（未戴口罩）
           1bu.jpeg  # 第2对照片中的第1张（未戴口罩）
           ...
           2999au.jpeg
           2999bu.jpeg
    ```

    则将仿照训练集的处理方式，为测试集中每张照片添加口罩，构造戴口罩的人脸测试集。处理完毕后目录结构如下：

    ```
    ├─false  # 该目录下共包含3000*2*2=12000张照片
    |      0am.jpeg  # 0au.jpeg对应的戴口罩人脸照片
    │      0au.jpeg  # 第1对照片中的第1张（未戴口罩）
    |      0bm.jpeg  # 0bu.jpeg对应的戴口罩人脸照片
    │      0bu.jpeg  # 第1对照片中的第2张（未戴口罩）
    |      1am.jpeg  # 以下同理
    │      1au.jpeg
    |      1bm.jpeg
    │      1bu.jpeg
           ...
    |      2999am.jpeg
    │      2999au.jpeg
    |      2999bm.jpeg
    │      2999bu.jpeg
    │      
    └─true # 该目录下共包含3000*2*2=12000张照片
           0am.jpeg  # 0au.jpeg对应的戴口罩人脸照片
           0au.jpeg  # 第1对照片中的第1张（未戴口罩）
           0bm.jpeg  # 0bu.jpeg对应的戴口罩人脸照片
           0bu.jpeg  # 第1对照片中的第2张（未戴口罩）
           1am.jpeg  # 以下同理
           1au.jpeg
           1bm.jpeg
           1bu.jpeg
           ...
           2999am.jpeg
           2999au.jpeg
           2999bm.jpeg
           2999bu.jpeg
    ```

    处理完毕后，测试集中照片数量将由12000张增长至约24000张（可能有个别照片因质量差无法添加口罩）。